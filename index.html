<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–°–∫–∞–Ω–µ—Ä —à—Ç—Ä–∏—Ö–∫–æ–¥–æ–≤</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; text-align: center; }
    #reader { width: 100%; max-width: 400px; margin: auto; }
  </style>
</head>
<body>
  <h3>–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ —à—Ç—Ä–∏—Ö–∫–æ–¥</h3>
  <div id="reader"></div>

  <script>
    console.log("üì¶ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∫–∞–Ω–µ—Ä–∞...");

    const html5QrCode = new Html5Qrcode("reader");

    const config = {
      fps: 10,
      qrbox: 250,
      formatsToSupport: [
        Html5QrcodeSupportedFormats.CODE_128,
        Html5QrcodeSupportedFormats.CODE_39,
        Html5QrcodeSupportedFormats.EAN_13,
        Html5QrcodeSupportedFormats.EAN_8,
        Html5QrcodeSupportedFormats.UPC_A,
        Html5QrcodeSupportedFormats.UPC_E,
        Html5QrcodeSupportedFormats.ITF
      ]
    };

    html5QrCode.start(
      { facingMode: "environment" },
      config,
      decodedText => {
        console.log("‚úÖ –ö–æ–¥ —Å—á–∏—Ç–∞–Ω:", decodedText);
        if (window.Telegram?.WebApp?.sendData) {
          console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram WebApp...");
          window.Telegram.WebApp.sendData(decodedText);
        } else {
          console.warn("‚ö†Ô∏è Telegram WebApp.sendData –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.");
          alert("–°—á–∏—Ç–∞–Ω–æ: " + decodedText);
        }
        html5QrCode.stop().then(() => {
          console.log("‚èπÔ∏è –°–∫–∞–Ω–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ—Å–ª–µ —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è.");
        }).catch(err => {
          console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–∫–∞–Ω–µ—Ä–∞:", err);
        });
      },
      errorMessage => {
        // –ú–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É –Ω–∏–∂–µ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–º–∞—Ö–∞
        // console.log("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å—á–∏—Ç–∞—Ç—å:", errorMessage);
      }
    ).then(() => {
      console.log("üé• –ö–∞–º–µ—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞.");
    }).catch(err => {
      console.error("üö´ –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É:", err);
      alert("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.");
    });
  </script>
</body>
</html>
