<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–°–∫–∞–Ω–µ—Ä —à—Ç—Ä–∏—Ö–∫–æ–¥–æ–≤</title>
  <!-- Telegram Web App SDK -->
  <script async src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; text-align: center; }
    #reader { width: 100%; max-width: 400px; margin: auto; }
  </style>
</head>
<body>
  <h3>–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ —à—Ç—Ä–∏—Ö–∫–æ–¥</h3>
  <div id="reader"></div>

  <script>
    // –£–≤–µ–¥–æ–º–ª—è–µ–º Telegram, —á—Ç–æ WebApp –≥–æ—Ç–æ–≤
    window.Telegram.WebApp.ready();
    alert("üì¶ WebApp –≥–æ—Ç–æ–≤. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∫–∞–Ω–µ—Ä–∞...");

    const html5QrCode = new Html5Qrcode("reader");
    const config = {
      fps: 10,
      qrbox: 250,
      formatsToSupport: [
        Html5QrcodeSupportedFormats.CODE_128,
        Html5QrcodeSupportedFormats.CODE_39,
        Html5QrcodeSupportedFormats.EAN_13,
        Html5QrcodeSupportedFormats.EAN_8,
        Html5QrcodeSupportedFormats.UPC_A,
        Html5QrcodeSupportedFormats.UPC_E,
        Html5QrcodeSupportedFormats.ITF
      ]
    };

    function startScanner() {
      html5QrCode.start(
        { facingMode: "environment" },
        config,
        onScanSuccess,
        errorMessage => {
          // –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –º–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å:
          // console.log("‚ùå –°–±–æ–π —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è:", errorMessage);
        }
      )
      .then(() => {
        console.log("üé• –ö–∞–º–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞");
        alert("üé• –ö–∞–º–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞, –Ω–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ —à—Ç—Ä–∏—Ö–∫–æ–¥");
      })
      .catch(err => {
        console.error("üö´ –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É:", err);
        alert("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.");
      });
    }

    function onScanSuccess(decodedText) {
      console.log("‚úÖ –ö–æ–¥ —Å—á–∏—Ç–∞–Ω:", decodedText);
      alert("‚úÖ –°—á–∏—Ç–∞–Ω —à—Ç—Ä–∏—Ö–∫–æ–¥: " + decodedText);

      if (window.Telegram?.WebApp?.sendData) {
        console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram...");
        window.Telegram.WebApp.sendData(decodedText);
        alert("üì§ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –±–æ—Ç–∞");
        window.Telegram.WebApp.close();  // –∑–∞–∫—Ä–æ–µ—Ç WebApp –∏ –≤–µ—Ä–Ω—ë—Ç –≤ —á–∞—Ç
      } else {
        console.warn("‚ö†Ô∏è sendData –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
        alert("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç–∞, sendData –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
      }
    }

    // –°—Ç–∞—Ä—Ç—É–µ–º —Å—Ä–∞–∑—É
    startScanner();
  </script>
</body>
</html>
